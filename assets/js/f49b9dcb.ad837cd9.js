(self.webpackChunkfossology_blogs=self.webpackChunkfossology_blogs||[]).push([[7790],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return d},kt:function(){return h}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),c=u(n),h=o,m=c["".concat(s,".").concat(h)]||c[h]||p[h]||r;return n?a.createElement(m,l(l({ref:t},d),{},{components:n})):a.createElement(m,l({ref:t},d))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,l=new Array(r);l[0]=c;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:o,l[1]=i;for(var u=2;u<r;u++)l[u]=n[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},6236:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return l},metadata:function(){return i},toc:function(){return s},default:function(){return d}});var a=n(2122),o=n(9756),r=(n(7294),n(3905)),l={},i={unversionedId:"docs/i18N-Internationalization",id:"docs/i18N-Internationalization",isDocsHomePage:!1,title:"i18N Internationalization",description:"Requirements",source:"@site/docs/docs/i18N-Internationalization.md",sourceDirName:"docs",slug:"/docs/i18N-Internationalization",permalink:"/fossology-blogs/docs/docs/i18N-Internationalization",editUrl:"https://github.com/Aman-Codes/fossology-blogs/edit/master/docs/docs/i18N-Internationalization.md",version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"fossology-gold-the-master-database-schema",permalink:"/fossology-blogs/docs/docs/fossology-gold-the-master-database-schema"},next:{title:"vagrant",permalink:"/fossology-blogs/docs/docs/vagrant"}},s=[{value:"Requirements",id:"requirements",children:[]},{value:"Step 1 - install gettext-library",id:"step-1---install-gettext-library",children:[]},{value:"Step 2 - separate message text from code",id:"step-2---separate-message-text-from-code",children:[{value:"Example 1",id:"example-1",children:[]},{value:"Example 2",id:"example-2",children:[]},{value:"Example 3",id:"example-3",children:[]}]},{value:"Notes",id:"notes",children:[]},{value:"Tutorial",id:"tutorial",children:[{value:"Requirements",id:"requirements-1",children:[]},{value:"Determine locale",id:"determine-locale",children:[]},{value:"Extract strings",id:"extract-strings",children:[]},{value:"Compilation",id:"compilation",children:[]},{value:"Add your language to i18n",id:"add-your-language-to-i18n",children:[]},{value:"Submit your files",id:"submit-your-files",children:[]},{value:"How it works",id:"how-it-works",children:[]},{value:"Finally",id:"finally",children:[]},{value:"Random Notes",id:"random-notes",children:[]}]}],u={toc:s};function d(e){var t=e.components,n=(0,o.Z)(e,["components"]);return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"requirements"},"Requirements"),(0,r.kt)("p",null,"Separate text in UI to facilitate i18N (Step 2)"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Only the user interface (web GUI) is internationalized.  All these files are located in fossology/ui/. "),(0,r.kt)("li",{parentName:"ul"},"Licenses are not translated.  Agent messages are not translated.  Code comments are not translated. "),(0,r.kt)("li",{parentName:"ul"},"Error strings from non-fossology libraries will have to be translated by their own locale settings (or not at all).  For example, this includes postgresql error strings, system error strings, etc.")),(0,r.kt)("h2",{id:"step-1---install-gettext-library"},"Step 1 - install gettext-library"),(0,r.kt)("p",null,"This will define the _() function used to do the string translation."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"<?php\nrequire_once('i18n.php');\necho _('hello world');\n?>\n")),(0,r.kt)("p",null,"Then the translatable strings are extracted and stored in a separate file (po-file)."),(0,r.kt)("p",null,"In the po-file, which is setup for each supported language, the translated strings are added."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'# this is messages.po in locale/de_DE/LC_MESSAGES\n\nmsgid "hello world"\n\nmsgstr "hallo welt"\n')),(0,r.kt)("p",null,"For performance reasons, this file is converted into a binary form (mo-file), and also stored in the same directory, fossology/ui/locale/de_DE/LC_MESSAGES.\nWhen the php-file is now requested, there is a tiny php-script - which is added by inserting it plainly or\nby using 'required_once', to identify the wanted locale-setting."),(0,r.kt)("p",null,"The lines to be added contain the gettext-specifics"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"// this is i18n.php\n[some code to determine locale and encoding]\nsetlocale(LC_MESSAGES, $locale);\nbindtextdomain($domain, './locale');\nbind_textdomain_codeset($domain, $encoding);\ntextdomain($domain);\n")),(0,r.kt)("h2",{id:"step-2---separate-message-text-from-code"},"Step 2 - separate message text from code"),(0,r.kt)("p",null,"To make it clear what is being translated, the translated string should be separated from the rest of the statement.  The translated text can include printf substitution characters (%s, etc) but should not contain variables, html tags, or anything set at runtime or translated by php, the compiler, or webserver."),(0,r.kt)("h3",{id:"example-1"},"Example 1"),(0,r.kt)("p",null,"Separate text for readability."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'$V.= displayMessage("Scheduling of re-analysis failed, return code: $rc");\n')),(0,r.kt)("p",null,"should be written as:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'$msg = "Scheduling of re-analysis failed, return code: ";\n$V.= displayMessage($msg.$rc);\n')),(0,r.kt)("p",null,"In the final step, this is run through gettext to perform the translation."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'$msg = _("Scheduling of re-analysis failed, return code: ");\n$V.= displayMessage($msg.$rc);\n')),(0,r.kt)("h3",{id:"example-2"},"Example 2"),(0,r.kt)("p",null,"Translate text not tags."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$VH .= \"<tr><th width='15%'>Count</th>\";\n")),(0,r.kt)("p",null,"should be"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'$text = _("Count");\n$VH .= "<tr><th width=\'15%\'>$text</th>";\n')),(0,r.kt)("h3",{id:"example-3"},"Example 3"),(0,r.kt)("p",null,"Substitution characters may be in translated string."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'printf( "<small>Elapsed time: %.2f seconds</small>", $Time);\n')),(0,r.kt)("p",null,"Should be written as"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'$text = _("Elapsed time: %.2f seconds");\nprintf( "<small>$text</small>", $Time);\n')),(0,r.kt)("h2",{id:"notes"},"Notes"),(0,r.kt)("p",null," We should provide a 'translators manual' that can be understood by non-technical users. Perhaps we can transfer the translation to an extra sub-project, so that translation can progress independently from major FO-releases? But that should done later, after the concept was firmly established.\nThis creates a new install dependency on the PHP-gettext library.  It would be good to failover to no translations if the library is not found.  In php we can test for the existence of the required functions and use stubs if they don't exist.\nIt's always a good idea to have a sort of testpage, where any user can navigate to, to find out which locale is set. Because many users might not be aware of the actual locale setting they use."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Hello Fossology-user,\n\nYour current locale is set to 'ES'. To set it to another\nlanguage, please consult <reference>.\nFOSSology currently has translations for the following\nlocales: ...\n")),(0,r.kt)("p",null,"The above should be translated to the current locale. "),(0,r.kt)("h2",{id:"tutorial"},"Tutorial"),(0,r.kt)("p",null,"This is a Tutorial on how to add new languages to FOSSology.  I want to thank Stefan Schroeder for writing the initial version of this tutorial and for leading us into multiple language support."),(0,r.kt)("h3",{id:"requirements-1"},"Requirements"),(0,r.kt)("p",null,"This tutorial will use the barebones commands that are available in any decent Linux distribution. If they are not: Switch to a better one, e.g. Debian or Ubuntu. I will refer to the debian-package names, so YMMV concerning the package names."),(0,r.kt)("p",null,"As root, install the packages for gettext, gettext-support for PHP."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"apt-get install gettext gettext-php\n")),(0,r.kt)("p",null,"The gettext package contains xgettext - which is required to extract the prepared strings from the PHP-sources - and msgfmt - which will compile the message catalogue into a binary form."),(0,r.kt)("p",null,"Before you get started make sure you are working on the latest version in the source tree."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"svn update\n")),(0,r.kt)("h3",{id:"determine-locale"},"Determine locale"),(0,r.kt)("p",null,"To find out the proper abbreviation for the language which you wish to provide.  Run"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"locale -a\n")),(0,r.kt)("p",null,"If the locale that you want to translate for is not available, refer to your distributions' i18n-documentation. There is a plethora of pages about language specific topics, some of them are authoritative, like RFCs, IANA and W3c-recommendations. Let's assume, that you select de_DE. Actually you don't want de_DE, because I already provided this one ;-)"),(0,r.kt)("h3",{id:"extract-strings"},"Extract strings"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd ~/fossology/trunk/fossology/ui\n")),(0,r.kt)("p",null,"Prepare the folder to store your translation"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"mkdir -p locale/de_DE/LC_MESSAGES\n")),(0,r.kt)("p",null,"The directory 'locale' should already exist or you are in the wrong working directory. Now collect all translatable strings to the new directory. xgettext does not support recursion, thus we use find to dive into the subdirectories."),(0,r.kt)("pre",null,'find . -iname "*.php" | \\ xargs xgettext -o locale/de_DE/LC_MESSAGES/messages.po'),(0,r.kt)("p",null,"Now edit locale/de_DE/LC_MESSAGES/messages.po and supply your translations for each string."),(0,r.kt)("pre",null,"vim locale/de_DE/LC_MESSAGES/messages.po"),(0,r.kt)("p",null,"The texts come in pairs: The untranslated original, followed by the translated string for you to enter. There are several tools out there, e.g. poedit or gtranslator."),(0,r.kt)("p",null,"In the header of the po-file you should supply some information about yourself (email) and you should define the character set like this:"),(0,r.kt)("pre",null,'"Content-Type: text/plain; charset=utf-8\\n"'),(0,r.kt)("p",null,"Note: I ran into some minor problems with the encoding: Although I selected UTF-8 for encoding everywhere, my browser did not properly display German umlauts when setting the pages' encoding type to utf-8 in the browser; I had to choose ISO-8859-1, which is not what I wanted or expected. As a work-around I wrote the umlauts as HTML-entities, like this ","\xe4"," and that works perfectly regardless of the browsers settings."),(0,r.kt)("pre",null,'... msgid "Welcome to FOSSology" msgstr "Willkommen bei FOSSology" ...'),(0,r.kt)("h3",{id:"compilation"},"Compilation"),(0,r.kt)("p",null,"Next, you have to compile the text version of your translations into a binary format using msgfmt."),(0,r.kt)("pre",null,"cd locale/de_DE/LC_MESSAGES msgfmt messages.po"),(0,r.kt)("p",null,"This will create messages.mo in the same directory."),(0,r.kt)("h3",{id:"add-your-language-to-i18n"},"Add your language to i18n"),(0,r.kt)("p",null,"Finally you have to add your language in fossology/ui/i18n.php  "),(0,r.kt)("pre",null,'// Add new languages below HERE! case ("de"): $locale = "de_DE"; break; // Add new languages above HERE!'),(0,r.kt)("p",null,"for the reasons I lay out in the last paragraph. Before testing your translation, don't forget to configure your browser to request your language. And change the line"),(0,r.kt)("pre",null,'//require("i18n.php"); DISABLED'),(0,r.kt)("p",null,"to"),(0,r.kt)("pre",null,'require("i18n.php"); // not DISABLED'),(0,r.kt)("p",null,"in fossology/ui/index.php."),(0,r.kt)("p",null,"Probably it's a good idea to restart apache after doing all this."),(0,r.kt)("pre",null,"/etc/init.d/apache2 restart"),(0,r.kt)("h3",{id:"submit-your-files"},"Submit your files"),(0,r.kt)("p",null,"After you verified the correct setup you have to add your new files to the svn-repository and update i18n.php, too. I won't explain that... Since I added the locale subtree to the install-Makefile, the next installation should be aware of your contribution. Please DO NOT update index.php in the repository. I'd like to keep i18n-support commented out until we do some more testing."),(0,r.kt)("h3",{id:"how-it-works"},"How it works"),(0,r.kt)("p",null,"index.php has to include i18n.php. Currently the inclusion is commented out and has to be activated by removal of the // comment in front of the call to require(). After the testing phase, I hope to have i18n activated by default."),(0,r.kt)("p",null,"i18n examines the browsers ACCEPT_LANGUAGE-field and extracts the first two characters. Then these two are mapped to the corresponding locale-directory. Therefore you have to add your language in i18n.php (with short name of your lanugage, like 'de' and your chosen locale directory, like de_DE. It is - of course - possible to automatically check for existing locales based on the ACCEPT_LANGUAGES-tags, but I prefer to have tight control over which languages are activated to prevent the usage of only partially translated message catalogues."),(0,r.kt)("p",null,'If you wish to examine what your browser sends in the accepted languages field I recommend the HTTP-liveheader "Add-On for Firefox":',(0,r.kt)("a",{parentName:"p",href:"https://addons.mozilla.org/en-US/firefox/addon/3829/"},"https://addons.mozilla.org/en-US/firefox/addon/3829/")),(0,r.kt)("h3",{id:"finally"},"Finally"),(0,r.kt)("p",null,"I NEED FEEDBACK for the tutorial. Please reply to the mailing list."),(0,r.kt)("p",null,'Note: The w3c does not recommend the chosen "approach":',(0,r.kt)("a",{parentName:"p",href:"http://www.w3.org/International/questions/qa-accept-lang-locales"},"http://www.w3.org/International/questions/qa-accept-lang-locales")),(0,r.kt)("p",null,"I will have to check this out."),(0,r.kt)("h3",{id:"random-notes"},"Random Notes"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Don't use ",(0,r.kt)("inlineCode",{parentName:"li"},"<i>"),". It's not yet deprecated, but will be really soon now."),(0,r.kt)("li",{parentName:"ul"},'It\'s a bad idea from a translators perspective to tear apart strings until they can no longer be translated without looking at the code.\nE.g. "Click here to continue" was separated into "Click" and "here" and "to continue", where ',(0,r.kt)("em",{parentName:"li"},"here")," was a href.\nThere are several issues here:")),(0,r.kt)("h1",{id:"you-cannot-understand-translate-any-of-the-three-strings-without-knowing-the-context"},"You cannot understand (=translate) any of the three strings without knowing the context."),(0,r.kt)("h1",{id:"you-never-name-a-link-herehttpwwwuseitcomalertbox980111html"},'You never name a link "',(0,r.kt)("em",{parentName:"h1"},"here"),'.":',(0,r.kt)("a",{parentName:"h1",href:"http://www.useit.com/alertbox/980111.html"},"http://www.useit.com/alertbox/980111.html")),(0,r.kt)("h1",{id:"you-cannot-understand-the-full-sentence-either"},"You cannot understand the full sentence either."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'  What to do? Rephrase: "Goto login-page" and make the full sentence a link.\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'Learn how to write good i18n-strings, "see":',(0,r.kt)("a",{parentName:"li",href:"http://www.gnu.org/software/gettext/manual/gettext.html"},"http://www.gnu.org/software/gettext/manual/gettext.html")," (OK, I haven't read all of it, albeit it's really a must-read)"),(0,r.kt)("li",{parentName:"ul"},'"And":',(0,r.kt)("a",{parentName:"li",href:"http://www.debian.org/doc/manuals/intro-i18n/index.en.html"},"http://www.debian.org/doc/manuals/intro-i18n/index.en.html")),(0,r.kt)("li",{parentName:"ul"},"There is no quick introduction to gettext for developers on the whole net!?")))}d.isMDXComponent=!0}}]);