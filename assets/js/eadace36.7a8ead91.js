(self.webpackChunkfossology_blogs=self.webpackChunkfossology_blogs||[]).push([[1106],{3905:function(e,n,t){"use strict";t.d(n,{Zo:function(){return c},kt:function(){return h}});var o=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,a=function(e,n){if(null==e)return{};var t,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=o.createContext({}),u=function(e){var n=o.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=u(e.components);return o.createElement(s.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},d=o.forwardRef((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=u(t),h=a,f=d["".concat(s,".").concat(h)]||d[h]||p[h]||r;return t?o.createElement(f,i(i({ref:n},c),{},{components:t})):o.createElement(f,i({ref:n},c))}));function h(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,i=new Array(r);i[0]=d;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var u=2;u<r;u++)i[u]=t[u];return o.createElement.apply(null,i)}return o.createElement.apply(null,t)}d.displayName="MDXCreateElement"},9018:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return i},metadata:function(){return l},toc:function(){return s},default:function(){return c}});var o=t(2122),a=t(9756),r=(t(7294),t(3905)),i={},l={unversionedId:"docs/External-authentication-configuration",id:"docs/External-authentication-configuration",isDocsHomePage:!1,title:"External-authentication-configuration",description:"Fossology can be configured to replace the default internal authentication scheme by any Apache web server based authentication mechanism.",source:"@site/docs/docs/External-authentication-configuration.md",sourceDirName:"docs",slug:"/docs/External-authentication-configuration",permalink:"/fossology-blogs/docs/docs/External-authentication-configuration",editUrl:"https://github.com/Aman-Codes/fossology-blogs/edit/master/docs/docs/External-authentication-configuration.md",version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Email notifications",permalink:"/fossology-blogs/docs/docs/Email-notification-configuration"},next:{title:"FOSSology-3.0-Release-Announcement",permalink:"/fossology-blogs/docs/docs/FOSSology-3.0-Release-Announcement"}},s=[{value:"General workflow",id:"general-workflow",children:[]},{value:"Features &amp; Options",id:"features--options",children:[{value:"Enable feature",id:"enable-feature",children:[]},{value:"Configure environment variables",id:"configure-environment-variables",children:[]},{value:"User auto-creation",id:"user-auto-creation",children:[]},{value:"Username case",id:"username-case",children:[]}]},{value:"Shibboleth",id:"shibboleth",children:[]}],u={toc:s};function c(e){var n=e.components,t=(0,a.Z)(e,["components"]);return(0,r.kt)("wrapper",(0,o.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Fossology can be configured to replace the default internal authentication scheme by any Apache web server based authentication mechanism."),(0,r.kt)("p",null,"The idea is to rely on an external service to authenticate users within Fossology: An authentication module in Apache handles the authentication process against an external service, and forwards all necessary information in HTTP header, then used by Fossology."),(0,r.kt)("h1",{id:"how-it-works"},"How it works"),(0,r.kt)("h2",{id:"general-workflow"},"General workflow"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Apache is configured to redirect unauthenticated users to an authentication provider (anything supported by an Apache module: OIDC, LDAP, etc.)"),(0,r.kt)("li",{parentName:"ol"},"The Apache module injects the authentication information in environment variables, that can be retrieved by the Fossology web pages.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"the exact variable names and content will depend on you Apache configuration and authentication provider."),(0,r.kt)("li",{parentName:"ul"},"see configuration below."))),(0,r.kt)("li",{parentName:"ol"},"Fossology reads this info through environment variables and authenticates the user.")),(0,r.kt)("h2",{id:"features--options"},"Features & Options"),(0,r.kt)("p",null,"The external authentication feature is configured in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/fossology/fossology/blob/master/install/defconf/fossology.conf.in"},"configuration file")," (block ",(0,r.kt)("inlineCode",{parentName:"p"},"[EXT_AUTH]"),")"),(0,r.kt)("h3",{id:"enable-feature"},"Enable feature"),(0,r.kt)("p",null,"To enable the feature, set: ",(0,r.kt)("inlineCode",{parentName:"p"},"CONF_EXT_AUTH_ENABLE=true")),(0,r.kt)("h3",{id:"configure-environment-variables"},"Configure environment variables"),(0,r.kt)("p",null,"The Username, email address and User description are taken from the environment variable as provided by the authentication provider. See:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"CONF_EXT_AUTH_ENV_USER=")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"CONF_EXT_AUTH_ENV_MAIL=")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"CONF_EXT_AUTH_ENV_DESC="))),(0,r.kt)("p",null,"Note that only the USER is mandatory for successful authentication."),(0,r.kt)("h3",{id:"user-auto-creation"},"User auto-creation"),(0,r.kt)("p",null,"If the user logging in does not exist yet, it can be automatically added to the database."),(0,r.kt)("p",null,"Enable: ",(0,r.kt)("inlineCode",{parentName:"p"},"CONF_EXT_AUTH_NEW_USER_AUTO_CREATE=true")),(0,r.kt)("p",null,"In that case, a list of agents can be selected for the new user:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"CONF_EXT_AUTH_NEW_USER_AGENT_LIST=<agent list>")),(0,r.kt)("p",null,"Example: ",(0,r.kt)("inlineCode",{parentName:"p"},'CONF_EXT_AUTH_NEW_USER_AGENT_LIST="agent_copyright,agent_keyword,agent_mimetype,agent_monk,agent_nomos,agent_ojo,agent_shagent"')),(0,r.kt)("h3",{id:"username-case"},"Username case"),(0,r.kt)("p",null,"Authentication providers may return usernames indifferently in lower or uppercase ; however, Fossology is case-sensitive when searching user entries in the database."),(0,r.kt)("p",null,"An option forces all incoming usernames to lowercase:"),(0,r.kt)("p",null,"See: ",(0,r.kt)("inlineCode",{parentName:"p"},"CONF_EXT_AUTH_LOWERCASE_USER=true")),(0,r.kt)("h1",{id:"caveats--missing-options"},"Caveats & Missing options"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Today, the ",(0,r.kt)("inlineCode",{parentName:"li"},"logout")," feature is ineffective."),(0,r.kt)("li",{parentName:"ul"},"On user creation, only the default list of agent is configurable"),(0,r.kt)("li",{parentName:"ul"},"REST API authentication exception may be a little tricky to configure")),(0,r.kt)("h1",{id:"rest-api"},"REST API"),(0,r.kt)("p",null,"With a basic configuration, Apache will redirect all queries within ",(0,r.kt)("inlineCode",{parentName:"p"},"http://fossology.fqdn/repo/"),"to the authentication provider.\nHowever, REST calls are authenticated with a separate token mechanism should be excluded from redirection."),(0,r.kt)("p",null,"Several solutions exist, depending on your authentication provider, for example:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"It may be possible to exclude a sub-space from authentication (see Shibboleth example below)"),(0,r.kt)("li",{parentName:"ul"},"If not (like with LDAP), the trick is to add a separate ",(0,r.kt)("inlineCode",{parentName:"li"},"Location")," section where authentication is not required.")),(0,r.kt)("h1",{id:"apache-configuration-examples"},"Apache configuration examples"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'<Directory "/usr/local/share/fossology/www/ui">\n    <IfModule mod_rewrite.c>\n        RewriteEngine on\n        RewriteCond %{REQUEST_FILENAME} !-d\n        RewriteCond %{REQUEST_FILENAME} !-f\n        RewriteRule "^api/(.*)" "/repo/api/index.php" [QSA,L]\n        RewriteRule .* - [env=HTTP_AUTHORIZATION:%{HTTP:Authorization}]\n    </IfModule>\n</Directory>\n\n<VirtualHost *:80>\n    ServerName https://fossology.fqdn\n    Alias /repo /usr/local/share/fossology/www/ui\n\n    php_flag display_errors on\n    php_value error_reporting 2039\n\n    <Location "/">\n        RedirectMatch "^/$" "http://fossology.fqdn/repo"\n    </Location>\n\n    <Location "/repo">\n        AllowOverride None\n        Options FollowSymLinks MultiViews\n\n        AuthLDAPURL "ldap://..."\n        AuthLDAPBindDN "..."\n        AuthLDAPBindPassword "..."\n        AuthLDAPInitialBindAsUser on\n        AuthLDAPInitialBindPattern (.+) uid=$1,ou=...\n        AuthType Basic\n        AuthName "Use LDAP Credentials"\n        AuthBasicProvider ldap\n        AuthUserFile /dev/null\n        require valid-user\n    </Location>\n\n    <Location "/repo/api">\n        Options Indexes FollowSymLinks MultiViews ExecCGI\n        AllowOverride None\n        Require all granted\n        Order allow,deny\n        allow from all\n    </Location>\n\n    ErrorLog /var/log/apache2/error.fossology.local.log\n    CustomLog /var/log/apache2/access.fossology.local.log combined\n</VirtualHost>\n')),(0,r.kt)("h2",{id:"shibboleth"},"Shibboleth"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'LoadModule mod_shib /usr/lib/apache2/modules/mod_shib2.so\n\n<VirtualHost *:80>\n\n    ServerName fossology-fqdn:80\n    Alias /repo /usr/local/share/fossology/www/ui\n\n    <Location "/repo">\n        AllowOverride None\n        Options FollowSymLinks MultiViews\n        AuthType shibboleth\n        Require shibboleth\n    </Location>\n</VirtualHost>\n')),(0,r.kt)("p",null,"REST API exception can be handled like above for LDAP, or directly in the Shibboleth configuration ;"),(0,r.kt)("p",null,"Example in shibboleth2.xml:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'    <RequestMapper type="Native">\n        <RequestMap>\n            <Host name="fqdn.org" authType="shibboleth" requireSession="true">\n                <AccessControl>\n                    <Rule require="profilsApplicatifs">FOSSOLOGY</Rule>\n                </AccessControl>\n                <Path name="/api" requireSession="false">\n                     <AccessControlProvider uri="accesscontrol.xml" type="..." />\n                </Path>\n            </Host>\n        </RequestMap>\n    </RequestMapper>\n')))}c.isMDXComponent=!0}}]);